# ===================================================================
# Flutter ì„¤ì • íŒŒì¼ ìë™ ì—…ë¡œë“œ ì›Œí¬í”Œë¡œìš°
# ===================================================================

name: PROJECT-FLUTTER-AUTO-FILE-UPLOAD

# ===================================================================
# ğŸ“‹ í•„ìˆ˜ GitHub Secrets ì„¤ì • ê°€ì´ë“œ
# ===================================================================
#
# âš ï¸ ì‚¬ìš©í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ë‹¤ìŒ GitHub Secretsë¥¼ ì„¤ì •í•˜ì„¸ìš”!
# (ì €ì¥ì†Œ Settings > Secrets and variables > Actionsì—ì„œ ì„¤ì •)
#
# ğŸ”§ í•„ìˆ˜ Secrets:
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Secret ì´ë¦„                                 â”‚ ì„¤ëª…                               â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ ENV                                         â”‚ Flutter .env íŒŒì¼ ë‚´ìš©             â”‚
# â”‚ SERVER_HOST                                 â”‚ ë°°í¬ ëŒ€ìƒ ì„œë²„ IP/ë„ë©”ì¸           â”‚
# â”‚ SERVER_USER                                 â”‚ ì„œë²„ SSH ì ‘ì† ì‚¬ìš©ìëª…             â”‚
# â”‚ SERVER_PASSWORD                             â”‚ ì„œë²„ SSH ì ‘ì† ë¹„ë°€ë²ˆí˜¸             â”‚
# â”‚ IOS_CERTIFICATE_BASE64                      â”‚ iOS ì¸ì¦ì„œ (Base64)                â”‚
# â”‚ IOS_CERTIFICATE_PASSWORD                    â”‚ iOS ì¸ì¦ì„œ ë¹„ë°€ë²ˆí˜¸                â”‚
# â”‚ IOS_PROVISIONING_PROFILE_BASE64             â”‚ iOS í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ (Base64)   â”‚
# â”‚ IOS_SHARE_EXTENSION_PROVISIONING_PROFILE_BASE64 â”‚ Share Extension í”„ë¡œíŒŒì¼ (Base64) â”‚
# â”‚ APPLE_TEAM_ID                               â”‚ Apple íŒ€ ID                        â”‚
# â”‚ APP_STORE_CONNECT_API_KEY_BASE64            â”‚ App Store Connect API í‚¤ (Base64)  â”‚
# â”‚ APP_STORE_CONNECT_API_KEY_ID                â”‚ App Store Connect API í‚¤ ID        â”‚
# â”‚ APP_STORE_CONNECT_ISSUER_ID                 â”‚ App Store Connect Issuer ID        â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# ğŸš€ ì›Œí¬í”Œë¡œìš° ê¸°ëŠ¥:
# - .env íŒŒì¼ì„ ì„œë²„ì— ìë™ ì—…ë¡œë“œ
# - iOS ì¸ì¦ì„œ ë° í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ ì—…ë¡œë“œ (Base64 ë””ì½”ë”©)
# - ìµœì‹  íŒŒì¼ + íƒ€ì„ìŠ¤íƒ¬í”„ ë°±ì—…ë³¸ ë™ì‹œ ì €ì¥
# - ë©”íƒ€ë°ì´í„° JSON íŒŒì¼ ìë™ ìƒì„± (ì‹¤ì œ Secret ê°’ í¬í•¨)
#
# ğŸ“ ì‚¬ìš© ë°©ë²•:
# 1. ìœ„ì˜ GitHub Secrets ì„¤ì •
# 2. ì›Œí¬í”Œë¡œìš° í™œì„±í™”: 'on' ì„¹ì…˜ í™•ì¸
#
# ===================================================================

# ===================================================================
# íŠ¸ë¦¬ê±° ì„¤ì •
# ===================================================================
on:
  push:
    branches:
      - main
  workflow_dispatch:

# ===================================================================
# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
# ===================================================================
env:
  PROJECT_NAME: "tripgether"
  BACKUP_DIR: "frontend"

jobs:
  # ===================================================================
  # íŒŒì¼ ì—…ë¡œë“œ ì‘ì—…
  # ===================================================================
  upload-files:
    name: ì„¤ì • íŒŒì¼ ì„œë²„ ì—…ë¡œë“œ
    runs-on: ubuntu-latest
    # PRì´ ì‹¤ì œë¡œ mergeëœ ê²½ìš°ì—ë§Œ ì‹¤í–‰ (ë‹«íˆê¸°ë§Œ í•œ ê²½ìš° ì œì™¸)
    if: github.event_name == 'workflow_dispatch' || github.event.pull_request.merged == true

    steps:
      # 1. ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      # 2. PR ì‘ì„±ì ë˜ëŠ” ì‹¤í–‰ì í™•ì¸
      - name: PR ì‘ì„±ì ë˜ëŠ” ì‹¤í–‰ì í™•ì¸
        id: get_actor
        run: |
          if [ "${{ github.event_name }}" = "pull_request_target" ]; then
            ACTOR="${{ github.event.pull_request.user.login }}"
            PR_NUMBER="${{ github.event.pull_request.number }}"
            echo "ğŸ” PR ì‘ì„±ì: $ACTOR (PR #$PR_NUMBER)"
          elif [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            ACTOR="${{ github.actor }}"
            PR_NUMBER="manual"
            echo "ğŸ‘¤ ìˆ˜ë™ ì‹¤í–‰ì: $ACTOR"
          else
            ACTOR="${{ github.actor }}"
            PR_NUMBER="push"
            echo "ğŸ“¤ Push ì‹¤í–‰ì: $ACTOR"
          fi

          echo "ACTOR=$ACTOR" >> $GITHUB_OUTPUT
          echo "PR_NUMBER=$PR_NUMBER" >> $GITHUB_OUTPUT

      # 3. íƒ€ì„ìŠ¤íƒ¬í”„ í´ë”ëª… ìƒì„±
      - name: íƒ€ì„ìŠ¤íƒ¬í”„ í´ë”ëª… ìƒì„±
        run: |
          export TZ='Asia/Seoul'
          ACTOR="${{ steps.get_actor.outputs.ACTOR }}"
          TIMESTAMP=$(date '+%Y-%m-%d_%H-%M-%S')_$ACTOR
          echo "TIMESTAMP=$TIMESTAMP" >> $GITHUB_ENV
          echo "BUILD_DATE=$(date '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_ENV
          echo "ìƒì„±ëœ íƒ€ì„ìŠ¤íƒ¬í”„: $TIMESTAMP"

      # 4. ì§§ì€ ì»¤ë°‹ í•´ì‹œ ê³„ì‚°
      - name: ì§§ì€ ì»¤ë°‹ í•´ì‹œ ê³„ì‚°
        run: |
          echo "SHORT_COMMIT_HASH=$(echo ${{ github.sha }} | cut -c1-7)" >> $GITHUB_ENV
          echo "ì§§ì€ ì»¤ë°‹ í•´ì‹œ: $(echo ${{ github.sha }} | cut -c1-7)"

      # 5. ì„œë²„ì— íŒŒì¼ ì—…ë¡œë“œ
      - name: ì„œë²„ì— íŒŒì¼ ì—…ë¡œë“œ
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_PASSWORD }}
          port: 2022
          envs: TIMESTAMP,SHORT_COMMIT_HASH,BUILD_DATE
          script: |
            set -e

            echo "ğŸ”§ í™˜ê²½ë³€ìˆ˜ ì„¤ì •..."
            export PW=${{ secrets.SERVER_PASSWORD }}
            export PROJECT_NAME="${{ env.PROJECT_NAME }}"

            # ë””ë ‰í† ë¦¬ ìƒì„±
            echo "ğŸ“ ë””ë ‰í† ë¦¬ ìƒì„± ì¤‘..."
            echo $PW | sudo -S mkdir -p /volume1/projects/${PROJECT_NAME}/github_secret/frontend
            echo $PW | sudo -S mkdir -p /volume1/projects/${PROJECT_NAME}/github_secret/frontend/ios
            echo $PW | sudo -S mkdir -p /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP
            echo $PW | sudo -S mkdir -p /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/ios

            # .env íŒŒì¼ ì—…ë¡œë“œ
            echo "ğŸ“¤ .env íŒŒì¼ ì—…ë¡œë“œ ì¤‘..."
            cat << 'EOF' | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/.env > /dev/null
            ${{ secrets.ENV }}
            EOF
            cat << 'EOF' | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/.env > /dev/null
            ${{ secrets.ENV }}
            EOF
            echo $PW | sudo -S chmod 600 /volume1/projects/${PROJECT_NAME}/github_secret/frontend/.env
            echo $PW | sudo -S chmod 600 /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/.env
            echo "âœ… .env ì—…ë¡œë“œ ì™„ë£Œ"

            # iOS ì¸ì¦ì„œ ì—…ë¡œë“œ (Base64 ë””ì½”ë”©)
            echo "ğŸ“¤ iOS ì¸ì¦ì„œ ì—…ë¡œë“œ ì¤‘..."
            echo "${{ secrets.IOS_CERTIFICATE_BASE64 }}" | base64 -d | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/ios/certificate.p12 > /dev/null
            echo "${{ secrets.IOS_CERTIFICATE_BASE64 }}" | base64 -d | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/ios/certificate.p12 > /dev/null
            echo $PW | sudo -S chmod 600 /volume1/projects/${PROJECT_NAME}/github_secret/frontend/ios/certificate.p12
            echo $PW | sudo -S chmod 600 /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/ios/certificate.p12
            echo "âœ… iOS ì¸ì¦ì„œ ì—…ë¡œë“œ ì™„ë£Œ"

            # í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ ì—…ë¡œë“œ (Base64 ë””ì½”ë”©)
            echo "ğŸ“¤ í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ ì—…ë¡œë“œ ì¤‘..."
            echo "${{ secrets.IOS_PROVISIONING_PROFILE_BASE64 }}" | base64 -d | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/ios/provisioning_profile.mobileprovision > /dev/null
            echo "${{ secrets.IOS_PROVISIONING_PROFILE_BASE64 }}" | base64 -d | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/ios/provisioning_profile.mobileprovision > /dev/null
            echo "âœ… Main í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ"

            # Share Extension í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ ì—…ë¡œë“œ
            echo "ğŸ“¤ Share Extension í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ ì—…ë¡œë“œ ì¤‘..."
            echo "${{ secrets.IOS_SHARE_EXTENSION_PROVISIONING_PROFILE_BASE64 }}" | base64 -d | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/ios/share_extension.mobileprovision > /dev/null
            echo "${{ secrets.IOS_SHARE_EXTENSION_PROVISIONING_PROFILE_BASE64 }}" | base64 -d | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/ios/share_extension.mobileprovision > /dev/null
            echo $PW | sudo -S chmod 644 /volume1/projects/${PROJECT_NAME}/github_secret/frontend/ios/*.mobileprovision
            echo $PW | sudo -S chmod 644 /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/ios/*.mobileprovision
            echo "âœ… Share Extension í”„ë¡œíŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ"

            # App Store Connect API í‚¤ ì—…ë¡œë“œ (Base64 ë””ì½”ë”©)
            echo "ğŸ“¤ App Store Connect API í‚¤ ì—…ë¡œë“œ ì¤‘..."
            echo "${{ secrets.APP_STORE_CONNECT_API_KEY_BASE64 }}" | base64 -d | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/ios/app_store_connect_api_key.p8 > /dev/null
            echo "${{ secrets.APP_STORE_CONNECT_API_KEY_BASE64 }}" | base64 -d | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/ios/app_store_connect_api_key.p8 > /dev/null
            echo $PW | sudo -S chmod 600 /volume1/projects/${PROJECT_NAME}/github_secret/frontend/ios/app_store_connect_api_key.p8
            echo $PW | sudo -S chmod 600 /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/ios/app_store_connect_api_key.p8
            echo "âœ… App Store Connect API í‚¤ ì—…ë¡œë“œ ì™„ë£Œ"

            # ë©”íƒ€ë°ì´í„° JSON íŒŒì¼ ìƒì„± (ì‹¤ì œ ê°’ í¬í•¨)
            echo "ğŸ“ ë©”íƒ€ë°ì´í„° JSON íŒŒì¼ ìƒì„± ì¤‘..."
            cat << EOF | sudo tee /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/cicd-gitignore-file.json > /dev/null
            {
              "build_info": {
                "timestamp": "$TIMESTAMP",
                "workflow": "Flutter ì„¤ì • íŒŒì¼ ê´€ë¦¬",
                "platform": "Flutter/Dart",
                "project_type": "mobile_app",
                "run_id": "${{ github.run_id }}",
                "run_number": "${{ github.run_number }}",
                "job": "upload-files",
                "event": "${{ github.event_name }}",
                "repository": "${{ github.repository }}",
                "owner": "${{ github.repository_owner }}",
                "branch": "${{ github.ref_name }}",
                "commit_hash": "${{ github.sha }}",
                "short_hash": "$SHORT_COMMIT_HASH",
                "commit_url": "https://github.com/${{ github.repository }}/commit/${{ github.sha }}",
                "actor": "${{ steps.get_actor.outputs.ACTOR }}",
                "pr_number": "${{ steps.get_actor.outputs.PR_NUMBER }}",
                "pr_author": "${{ github.event.pull_request.user.login || 'N/A' }}",
                "merged_by": "${{ github.event.pull_request.merged_by.login || 'N/A' }}",
                "triggering_actor": "${{ github.triggering_actor }}",
                "build_date": "$BUILD_DATE",
                "runner_os": "${{ runner.os }}"
              },
              "files": [
                {
                  "file_name": ".env",
                  "file_path": "/",
                  "type": "environment_variables",
                  "last_updated": "$BUILD_DATE",
                  "source_secret": "ENV",
                  "description": "Flutter í™˜ê²½ ë³€ìˆ˜ (API í‚¤, ì—”ë“œí¬ì¸íŠ¸ ë“±)"
                },
                {
                  "file_name": "certificate.p12",
                  "file_path": "/ios/",
                  "type": "ios_certificate",
                  "last_updated": "$BUILD_DATE",
                  "source_secret": "IOS_CERTIFICATE_BASE64",
                  "description": "iOS ì½”ë“œ ì„œëª… ì¸ì¦ì„œ (Base64 ë””ì½”ë”©ë¨)"
                },
                {
                  "file_name": "provisioning_profile.mobileprovision",
                  "file_path": "/ios/",
                  "type": "ios_provisioning_profile",
                  "last_updated": "$BUILD_DATE",
                  "source_secret": "IOS_PROVISIONING_PROFILE_BASE64",
                  "description": "iOS ì•± í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ (Base64 ë””ì½”ë”©ë¨)"
                },
                {
                  "file_name": "share_extension.mobileprovision",
                  "file_path": "/ios/",
                  "type": "ios_provisioning_profile",
                  "last_updated": "$BUILD_DATE",
                  "source_secret": "IOS_SHARE_EXTENSION_PROVISIONING_PROFILE_BASE64",
                  "description": "iOS Share Extension í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ (Base64 ë””ì½”ë”©ë¨)"
                },
                {
                  "file_name": "app_store_connect_api_key.p8",
                  "file_path": "/ios/",
                  "type": "app_store_connect_api_key",
                  "last_updated": "$BUILD_DATE",
                  "source_secret": "APP_STORE_CONNECT_API_KEY_BASE64",
                  "description": "App Store Connect API í‚¤ (Base64 ë””ì½”ë”©ë¨)"
                }
              ],
              "github_secrets_used": [
                {
                  "name": "ENV",
                  "type": "configuration",
                  "usage": "Flutter í™˜ê²½ ë³€ìˆ˜",
                  "category": "application",
                  "value_preview": "íŒŒì¼ë¡œ ì €ì¥ë¨ (.env)"
                },
                {
                  "name": "IOS_CERTIFICATE_BASE64",
                  "type": "credential",
                  "usage": "iOS ì½”ë“œ ì„œëª…",
                  "category": "ios_build",
                  "value_preview": "ë°”ì´ë„ˆë¦¬ íŒŒì¼ë¡œ ì €ì¥ë¨ (certificate.p12)"
                },
                {
                  "name": "IOS_CERTIFICATE_PASSWORD",
                  "type": "credential",
                  "usage": "iOS ì¸ì¦ì„œ ì•”í˜¸",
                  "category": "ios_build",
                  "value": "${{ secrets.IOS_CERTIFICATE_PASSWORD }}"
                },
                {
                  "name": "IOS_PROVISIONING_PROFILE_BASE64",
                  "type": "credential",
                  "usage": "iOS ì•± ë°°í¬ í”„ë¡œíŒŒì¼",
                  "category": "ios_build",
                  "value_preview": "ë°”ì´ë„ˆë¦¬ íŒŒì¼ë¡œ ì €ì¥ë¨ (provisioning_profile.mobileprovision)"
                },
                {
                  "name": "IOS_SHARE_EXTENSION_PROVISIONING_PROFILE_BASE64",
                  "type": "credential",
                  "usage": "iOS Share Extension ë°°í¬",
                  "category": "ios_build",
                  "value_preview": "ë°”ì´ë„ˆë¦¬ íŒŒì¼ë¡œ ì €ì¥ë¨ (share_extension.mobileprovision)"
                },
                {
                  "name": "APPLE_TEAM_ID",
                  "type": "configuration",
                  "usage": "Apple ê°œë°œì íŒ€ ì‹ë³„",
                  "category": "ios_build",
                  "value": "${{ secrets.APPLE_TEAM_ID }}"
                },
                {
                  "name": "APP_STORE_CONNECT_API_KEY_BASE64",
                  "type": "credential",
                  "usage": "App Store Connect API ì¸ì¦",
                  "category": "ios_deployment",
                  "value_preview": "ë°”ì´ë„ˆë¦¬ íŒŒì¼ë¡œ ì €ì¥ë¨ (app_store_connect_api_key.p8)"
                },
                {
                  "name": "APP_STORE_CONNECT_API_KEY_ID",
                  "type": "configuration",
                  "usage": "App Store Connect API í‚¤ ID",
                  "category": "ios_deployment",
                  "value": "${{ secrets.APP_STORE_CONNECT_API_KEY_ID }}"
                },
                {
                  "name": "APP_STORE_CONNECT_ISSUER_ID",
                  "type": "configuration",
                  "usage": "App Store Connect Issuer ID",
                  "category": "ios_deployment",
                  "value": "${{ secrets.APP_STORE_CONNECT_ISSUER_ID }}"
                },
                {
                  "name": "SERVER_HOST",
                  "type": "credential",
                  "usage": "SSH ì ‘ì†ìš© ì„œë²„ í˜¸ìŠ¤íŠ¸",
                  "category": "infrastructure",
                  "value": "${{ secrets.SERVER_HOST }}"
                },
                {
                  "name": "SERVER_USER",
                  "type": "credential",
                  "usage": "SSH ì ‘ì†ìš© ì‚¬ìš©ìëª…",
                  "category": "infrastructure",
                  "value": "${{ secrets.SERVER_USER }}"
                },
                {
                  "name": "_GITHUB_PAT_TOKEN",
                  "type": "credential",
                  "usage": "GitHub API ì¸ì¦ í† í° (Organization Secret)",
                  "category": "github",
                  "scope": "organization",
                  "value_preview": "ë³´ì•ˆìƒ ë…¸ì¶œí•˜ì§€ ì•ŠìŒ"
                }
              ],
              "deployment_targets": {
                "ios": {
                  "enabled": true,
                  "team_id": "${{ secrets.APPLE_TEAM_ID }}",
                  "has_certificate": true,
                  "has_provisioning_profile": true,
                  "has_share_extension": true,
                  "app_store_connect": {
                    "api_key_id": "${{ secrets.APP_STORE_CONNECT_API_KEY_ID }}",
                    "issuer_id": "${{ secrets.APP_STORE_CONNECT_ISSUER_ID }}"
                  }
                },
                "android": {
                  "enabled": false,
                  "note": "Android ë°°í¬ ì„¤ì •ì€ ë³„ë„ êµ¬ì„± í•„ìš”"
                }
              },
              "server_info": {
                "host": "${{ secrets.SERVER_HOST }}",
                "user": "${{ secrets.SERVER_USER }}",
                "port": 2022,
                "base_path": "/volume1/projects/${PROJECT_NAME}/github_secret/frontend"
              }
            }
            EOF
            echo "âœ… ë©”íƒ€ë°ì´í„° JSON íŒŒì¼ ìƒì„± ì™„ë£Œ"

            echo ""
            echo "âœ… ëª¨ë“  íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ!"
            echo ""
            echo "ğŸ“‹ ì—…ë¡œë“œ ê²°ê³¼ ìš”ì•½:"
            echo "  ğŸ¯ í”„ë¡œì íŠ¸: ${PROJECT_NAME}"
            echo "  ğŸ“± í”Œë«í¼: Flutter Mobile App"
            echo "  ğŸ‘¤ PR ì‘ì„±ì: ${{ steps.get_actor.outputs.ACTOR }}"
            echo "  ğŸ”¢ PR ë²ˆí˜¸: #${{ steps.get_actor.outputs.PR_NUMBER }}"
            echo "  ğŸŒ¿ ë¸Œëœì¹˜: ${{ github.ref_name }}"
            echo "  ğŸ“ ì €ì¥ ê²½ë¡œ: /volume1/projects/${PROJECT_NAME}/github_secret/frontend/"
            echo "  ğŸ’¾ ë°±ì—… ê²½ë¡œ: /volume1/projects/${PROJECT_NAME}/github_secret/frontend/$TIMESTAMP/"
            echo "  â° ì—…ë¡œë“œ ì‹œê°„: $BUILD_DATE"
            echo "  ğŸ“Š ì—…ë¡œë“œëœ íŒŒì¼:"
            echo "     - .env (í™˜ê²½ ë³€ìˆ˜)"
            echo "     - ios/certificate.p12 (ì¸ì¦ì„œ)"
            echo "     - ios/provisioning_profile.mobileprovision (í”„ë¡œíŒŒì¼)"
            echo "     - ios/share_extension.mobileprovision (Share Extension)"
            echo "     - ios/app_store_connect_api_key.p8 (App Store Connect API í‚¤)"
            echo "     - cicd-gitignore-file.json (ë©”íƒ€ë°ì´í„°)"
            echo "  ğŸ”‘ ì‚¬ìš©ëœ Secrets: 12ê°œ"
            echo "     - Repository Secrets: 9ê°œ"
            echo "     - Organization Secrets: 1ê°œ"
            echo "     - Server Credentials: 2ê°œ"
            echo ""
            echo "ğŸ“ ë©”íƒ€ë°ì´í„° ì •ë³´:"
            echo "  - APPLE_TEAM_ID: ${{ secrets.APPLE_TEAM_ID }}"
            echo "  - APP_STORE_CONNECT_API_KEY_ID: ${{ secrets.APP_STORE_CONNECT_API_KEY_ID }}"
            echo "  - APP_STORE_CONNECT_ISSUER_ID: ${{ secrets.APP_STORE_CONNECT_ISSUER_ID }}"
            echo "  - IOS_CERTIFICATE_PASSWORD: ${{ secrets.IOS_CERTIFICATE_PASSWORD }}"
            echo "  - SERVER_HOST: ${{ secrets.SERVER_HOST }}"
            echo "  - SERVER_USER: ${{ secrets.SERVER_USER }}"

# ===================================================================
# ì‚¬ìš© ì˜ˆì‹œ
# ===================================================================
#
# deploy ë¸Œëœì¹˜ë¡œ PR merge ì‹œ ìë™ ì—…ë¡œë“œ
#
# í•„ìš”í•œ Secrets:
# - ENV (í•„ìˆ˜)
# - IOS_CERTIFICATE_BASE64 (í•„ìˆ˜)
# - IOS_CERTIFICATE_PASSWORD (í•„ìˆ˜)
# - IOS_PROVISIONING_PROFILE_BASE64 (í•„ìˆ˜)
# - IOS_SHARE_EXTENSION_PROVISIONING_PROFILE_BASE64 (í•„ìˆ˜)
# - APPLE_TEAM_ID (í•„ìˆ˜)
# - APP_STORE_CONNECT_API_KEY_BASE64 (í•„ìˆ˜)
# - APP_STORE_CONNECT_API_KEY_ID (í•„ìˆ˜)
# - APP_STORE_CONNECT_ISSUER_ID (í•„ìˆ˜)
# - SERVER_HOST, SERVER_USER, SERVER_PASSWORD (í•„ìˆ˜)
#
# ===================================================================
